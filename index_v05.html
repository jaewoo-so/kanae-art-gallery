<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yoshimura Kanae</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;500;700&family=Noto+Sans+KR:wght@300;500;700&display=swap');

        body {
            font-family: 'Noto Sans JP', 'Noto Sans KR', sans-serif;
            background: #000; margin: 0; padding: 0;
            height: 100vh; overflow: hidden;
            overscroll-behavior: none;
        }

        .swiper-container-h, .swiper-container-v, .swiper-slide { width: 100%; height: 100%; }
        .swiper-slide {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            position: relative; overflow: hidden;
        }

        .slide-bg {
            position: absolute; left: 0; top: 0;
            width: 130%; height: 130%;
            background-size: cover; background-position: center;
            filter: blur(15px) brightness(0.7);
            z-index: -1; transform: translate(-15%, -15%);
        }

        .artwork-container {
            position: relative; width: 80%; max-width: 400px;
            border-radius: 12px; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
        }
        .ratio-portrait { aspect-ratio: 3/4; }
        .ratio-landscape { aspect-ratio: 4/3; }
        .ratio-square { aspect-ratio: 1/1; }
        .artwork-image { width: 100%; height: 100%; object-fit: cover; }
        
        .sidebar-menu {
            position: fixed; z-index: 40;
            display: flex; flex-direction: row; gap: 20px;
            bottom: 40px; top: auto; left: 50%; transform: translateX(-50%);
            transition: opacity 0.3s ease;
        }
        /* 메인 페이지일 때 메뉴 숨기고 싶으면 사용 (현재는 안씀) */
        .sidebar-hidden { opacity: 0; pointer-events: none; }

        .category-btn {
            width: 45px; height: 45px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px; backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.85);
        }
        .category-btn svg { width: 25px; height: 25px; fill: currentColor; opacity: 0.6; transition: all 0.3s ease; }
        .icon-mask { width: 25px; height: 25px; background-color: currentColor; -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; -webkit-mask-position: center; mask-position: center; opacity: 0.6; transition: all 0.3s ease; }
        .category-btn.active { border-color: currentColor; background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }
        .category-btn.active svg, .category-btn.active .icon-mask { opacity: 1; }

        body.theme-light .category-btn { border-color: rgba(0,0,0,0.2); color: rgba(0,0,0,0.8); } 
        body.theme-dark .category-btn { border-color: rgba(255,255,255,0.3); color: rgba(255,255,255,0.85); }

        .text-floating {
            color: rgba(255, 255, 255, 0.85) !important; 
            text-shadow: 0 4px 8px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, text-shadow 0.3s ease, opacity 0.3s ease;
        }
        .text-floating:hover { transform: translateY(-3px); opacity: 1; text-shadow: 0 10px 20px rgba(0,0,0,0.6); }

        .sns-icon-box { display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; }
        .sns-icon-box i { display: block; line-height: 1; }
        .fa-instagram { font-size: 40px; }
        .fa-line { font-size: 34px; }

        .bio-scroll-container {
            width: 100%; height: 100%; overflow-y: auto;
            padding: 100px 20px 100px 20px; 
            scrollbar-width: none; -ms-overflow-style: none;
        }
        .bio-scroll-container::-webkit-scrollbar { display: none; }
        .bio-grid-item img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }

        .nav-arrow {
            position: fixed; z-index: 30;
            color: #fff; font-size: 1.5rem; 
            opacity: 0; cursor: pointer; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
            transition: opacity 0.5s ease; pointer-events: none;
        }
        .nav-arrow.visible { opacity: 0.3; pointer-events: auto; }
        
        .nav-up { top: 130px; left: 50%; transform: translateX(-50%); } 
        .nav-down { bottom: 130px; left: 50%; transform: translateX(-50%); } 
        .nav-left { top: 50%; left: 30px; transform: translateY(-50%); } 
        .nav-right { top: 50%; right: 30px; transform: translateY(-50%); }
        .hidden-arrow { display: none !important; }

        body.theme-light .nav-arrow { color: #000; }

        
    </style>
</head>
<body class="theme-dark">
    <nav class="fixed left-0 w-full z-50 flex justify-between items-center p-4 md:p-6 transition-colors duration-300" style="top: 40px;">
        <div class="flex items-center gap-3 md:gap-6 pl-2 md:pl-16">
            <div class="text-floating text-lg md:text-xl font-bold tracking-widest uppercase whitespace-nowrap">
                Yoshimura kanae
            </div>
        </div>
        <div class="flex flex-row gap-8 items-center mr-2"> 
            <a href="https://www.instagram.com/my_insta_id" target="_blank" class="text-floating flex items-center gap-2 group cursor-pointer" title="Instagram">
                <div class="sns-icon-box"><i class="fa-brands fa-instagram"></i></div>
                <span class="text-base font-light hidden md:block group-hover:underline">Insta</span>
            </a>
            <div onclick="copyLineID('my_line_id')" class="text-floating flex items-center gap-2 group cursor-pointer" title="Click to Copy ID">
                <div class="sns-icon-box"><i class="fa-brands fa-line"></i></div>
                <span class="text-base font-light hidden md:block group-hover:underline">Line</span>
            </div>
        </div>
    </nav>

    <div id="nav-up" class="nav-arrow nav-up"><i class="fa-solid fa-chevron-up"></i></div>
    <div id="nav-down" class="nav-arrow nav-down"><i class="fa-solid fa-chevron-down"></i></div>
    <div id="nav-left" class="nav-arrow nav-left"><i class="fa-solid fa-chevron-left"></i></div>
    <div id="nav-right" class="nav-arrow nav-right"><i class="fa-solid fa-chevron-right"></i></div>

    <aside class="sidebar-menu" id="sidebar-container"></aside>
    
    <div class="swiper swiper-container-h">
        <div class="swiper-wrapper" id="main-swiper-wrapper"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="data.js"></script>

    <script>
        function copyLineID(id) {
            navigator.clipboard.writeText(id).then(() => {
                alert(`라인 ID가 복사되었습니다!\n(ID: ${id})`);
            }).catch(err => {
                console.error('복사 실패:', err);
                prompt("이 ID를 복사해서 친구추가 하세요:", id);
            });
        }

        const mainSwiperWrapper = document.getElementById('main-swiper-wrapper');
        const sidebarContainer = document.getElementById('sidebar-container');
        
        const navArrows = {
            up: document.getElementById('nav-up'),
            down: document.getElementById('nav-down'),
            left: document.getElementById('nav-left'),
            right: document.getElementById('nav-right')
        };
        const allArrows = Object.values(navArrows);

        function getImagePath(folderName, fileName) { return `images/${folderName}/${fileName}`; }
        function getIconPath(fileName) { return `images/icons/${fileName}`; }

        const allCategories = [...MY_DATA.galleries];
        if (MY_DATA.bio) allCategories.push({ type: 'bio', ...MY_DATA.bio });

        // 공통 인트로 슬라이드 생성 함수
        function createIntroSlide() {
            if (!MY_DATA.intro) return '';
            const introPath = getImagePath(MY_DATA.intro.targetFolderId, MY_DATA.intro.bgImage);
            const isVideo = MY_DATA.intro.bgImage.toLowerCase().endsWith('.mp4');
            let bgHTML = '';

            if (isVideo) {
                bgHTML = `
                    <video autoplay loop muted playsinline 
                        class="absolute top-0 left-0 w-[130%] h-[130%] object-cover -translate-x-[15%] -translate-y-[15%] -z-10"
                        style="filter: brightness(0.5);" 
                        data-swiper-parallax="50%">
                        <source src="${introPath}" type="video/mp4">
                    </video>
                `;
            } else {
                bgHTML = `
                    <div class="slide-bg" 
                        style="background-image: url('${introPath}'); filter: blur(15px) brightness(0.7);" 
                        data-swiper-parallax="50%">
                    </div>
                `;
            }

            return `
                <div class="swiper-slide intro-slide" data-theme="dark">
                    ${bgHTML}
                    <div class="artwork-container ratio-portrait" style="border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02);">
                        <div class="p-8 flex flex-col items-center justify-center text-center h-full w-full">
                            
                            <p class="text-lg md:text-xl leading-relaxed text-floating whitespace-pre-line">${MY_DATA.intro.message}</p>
                            <div class="mt-12 text-floating opacity-70 animate-bounce">
                                <i class="fa-solid fa-chevron-down text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        allCategories.forEach((cat, index) => {
            const btn = document.createElement('button');
            btn.className = `category-btn ${index === 0 ? 'active' : ''}`;
            btn.onclick = () => swiperH.slideTo(index);
            
            if (cat.icon.startsWith('M')) {
                btn.innerHTML = `<svg viewBox="0 0 24 24"><path d="${cat.icon}"/></svg>`;
            } else {
                const iconUrl = getIconPath(cat.icon);
                btn.innerHTML = `<div class="icon-mask" style="-webkit-mask-image: url('${iconUrl}'); mask-image: url('${iconUrl}');"></div>`;
            }
            sidebarContainer.appendChild(btn);

            const hSlide = document.createElement('div');
            hSlide.className = 'swiper-slide';

            // [구조 통일] 모든 카테고리는 Vertical Swiper를 가짐. Slide 0은 무조건 인트로.
            let vSlidesHTML = createIntroSlide();

            if (cat.type === 'bio') {
                // Bio 페이지도 2층(Slide 1)에 배치
                const bgPath = getImagePath(cat.id, cat.backgroundImg);
                vSlidesHTML += `
                    <div class="swiper-slide" data-theme="dark">
                        <div class="slide-bg" style="background-image: url('${bgPath}'); filter: blur(20px) brightness(0.5);" data-swiper-parallax="50%"></div>
                        <div class="bio-scroll-container text-white">
                            <div class="max-w-2xl mx-auto">
                                <h1 class="text-4xl font-bold mb-2 text-center" data-swiper-parallax="-300">${cat.title}</h1>
                                <p class="text-center text-gray-400 mb-12 text-sm" data-swiper-parallax="-200">${cat.subtitle}</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-10 text-center md:text-left" data-swiper-parallax="-100">
                                    ${cat.history.map(item => `
                                        <div class="bio-grid-item flex flex-col items-center md:items-start">
                                            <img src="${getImagePath(cat.id, item.img)}" alt="${item.title}">
                                            <div class="text-xs mt-2">
                                                <div class="font-bold text-lg">${item.title}</div>
                                                <div class="text-gray-400">${item.date}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="text-center text-xs text-gray-500 pb-10">&copy; 2026 Portfolio.</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // 일반 갤러리 슬라이드 (Slide 1부터 시작)
                vSlidesHTML += cat.slides.map(slide => {
                    const imgPath = getImagePath(cat.id, slide.img);
                    return `
                        <div class="swiper-slide" data-theme="${slide.theme}">
                            <div class="slide-bg" style="background-image: url('${imgPath}'); ${slide.theme==='light' ? 'filter: blur(15px) brightness(1.2);' : ''}" data-swiper-parallax="50%"></div>
                            <div class="artwork-container ${slide.ratio}">
                                <img src="${imgPath}" class="artwork-image">
                            </div>
                        </div>
                    `;
                }).join('');
            }

            hSlide.innerHTML = `
                <div class="swiper swiper-container-v">
                    <div class="swiper-wrapper">${vSlidesHTML}</div>
                    <div class="swiper-pagination"></div>
                </div>
            `;
            
            mainSwiperWrapper.appendChild(hSlide);
        });

        // 2초 타이머
        let arrowTimer;
        function flashArrows() {
            if (isCurrentSlideIntro()) {
                // 메인 페이지면 화살표 4개 다 숨김 (중앙 바운스 화살표가 있기 때문)
                allArrows.forEach(arrow => arrow.classList.remove('visible'));
            } else {
                // 갤러리 페이지면 화살표 보여주고 2초뒤 숨김
                allArrows.forEach(arrow => arrow.classList.add('visible'));
                clearTimeout(arrowTimer);
                arrowTimer = setTimeout(() => {
                    allArrows.forEach(arrow => arrow.classList.remove('visible'));
                }, 2000);
            }
        }

        // 현재 메인(Intro)인지 확인하는 함수
        function isCurrentSlideIntro() {
            const activeHSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeHSlide.querySelector('.swiper-container-v')?.swiper;
            // Vertical Swiper의 Index가 0이면 메인 페이지임
            return (vSwiper && vSwiper.activeIndex === 0);
        }

        // Horizontal Swiper
        var swiperH = new Swiper(".swiper-container-h", {
            spaceBetween: 50, direction: 'horizontal', effect: 'slide', speed: 600,
            allowTouchMove: false, // 초기값: 잠금 (메인이니까)
            on: { 
                slideChangeTransitionStart: function () {
                    // [핵심] 옆으로 넘어갈 때, 다음 카테고리도 '갤러리(1층)'로 바로 이동시키기
                    // 현재 내가 갤러리(1층)에 있었다면, 다음 방도 1층으로 안내
                    const activeVSwiper = this.slides[this.activeIndex].querySelector('.swiper-container-v')?.swiper;
                    if(activeVSwiper) {
                        // 강제로 1번 슬라이드(첫번째 이미지)로 점프. 0(Intro) 건너뜀.
                        activeVSwiper.slideTo(1, 0); 
                    }
                },
                slideChange: function () { 
                    updateActiveButton(this.activeIndex); 
                    updateThemeColor(); 
                    updateArrowState(); 
                    flashArrows(); 
                },
                init: function() { setTimeout(() => { updateArrowState(); }, 100); }
            }
        });

        // Vertical Swiper
        var swiperV = new Swiper(".swiper-container-v", {
            direction: "vertical", spaceBetween: 0, mousewheel: true, parallax: true,
            speed: 1000, nested: true, touchRatio: 1.2, resistanceRatio: 0.65,
            on: { 
                slideChange: function () { 
                    updateThemeColor(); 
                    updateArrowState();
                    flashArrows(); 
                    checkHorizontalLock(); // 위아래 움직일 때마다 잠금 체크
                } 
            }
        });

        // [핵심] 가로 이동 잠금/해제 로직
        function checkHorizontalLock() {
            const activeHSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeHSlide.querySelector('.swiper-container-v')?.swiper;
            
            if (vSwiper) {
                if (vSwiper.activeIndex === 0) {
                    // 메인(0번) -> 가로 잠금
                    swiperH.allowTouchMove = false;
                } else {
                    // 갤러리(1번 이상) -> 가로 풀림
                    swiperH.allowTouchMove = true;
                }
            }
        }

        navArrows.left.onclick = () => { swiperH.slidePrev(); flashArrows(); };
        navArrows.right.onclick = () => { swiperH.slideNext(); flashArrows(); };
        navArrows.up.onclick = () => {
            const activeSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeSlide.querySelector('.swiper-container-v')?.swiper;
            if(vSwiper) { vSwiper.slidePrev(); flashArrows(); }
        };
        navArrows.down.onclick = () => {
            const activeSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeSlide.querySelector('.swiper-container-v')?.swiper;
            if(vSwiper) { vSwiper.slideNext(); flashArrows(); }
        };
        
        document.addEventListener('touchstart', flashArrows);
        document.addEventListener('click', flashArrows);

        function updateArrowState() {
            if (isCurrentSlideIntro()) {
                // 메인이면 4개 화살표 모두 숨김
                allArrows.forEach(arrow => arrow.classList.add('hidden-arrow'));
                return;
            }

            // 갤러리 페이지 로직
            if (swiperH.isBeginning) navArrows.left.classList.add('hidden-arrow');
            else navArrows.left.classList.remove('hidden-arrow');

            if (swiperH.isEnd) navArrows.right.classList.add('hidden-arrow');
            else navArrows.right.classList.remove('hidden-arrow');

            const activeHIndex = swiperH.activeIndex;
            const activeSlide = swiperH.slides[activeHIndex];
            const vSwiperContainer = activeSlide.querySelector('.swiper-container-v');
            
            if (vSwiperContainer) {
                const vSwiper = vSwiperContainer.swiper;
                // 위쪽 화살표: 메인으로 가는 길이므로 항상 보여야 함 (Intro가 0번이므로 1번 이상이면 보임)
                if (vSwiper.activeIndex > 0) navArrows.up.classList.remove('hidden-arrow');
                else navArrows.up.classList.add('hidden-arrow');

                if (vSwiper.isEnd) navArrows.down.classList.add('hidden-arrow');
                else navArrows.down.classList.remove('hidden-arrow');
            }
        }

        function updateActiveButton(index) {
            const btns = document.querySelectorAll('.category-btn');
            btns.forEach(b => b.classList.remove('active'));
            if(btns[index]) btns[index].classList.add('active');
        }

        function updateThemeColor() {
            const activeHSlide = document.querySelectorAll('.swiper-container-h > .swiper-wrapper > .swiper-slide')[swiperH.activeIndex];
            if (!activeHSlide) return;
            const vSwiperContainer = activeHSlide.querySelector('.swiper-container-v');
            if(vSwiperContainer && vSwiperContainer.swiper) {
                const activeVSlide = vSwiperContainer.swiper.slides[vSwiperContainer.swiper.activeIndex];
                if(activeVSlide) {
                    applyTheme(activeVSlide.getAttribute('data-theme'));
                    return;
                }
            }
            if (activeHSlide.getAttribute('data-theme')) {
                applyTheme(activeHSlide.getAttribute('data-theme'));
            }
        }

        function applyTheme(theme) {
            document.body.className = theme === 'light' ? 'theme-light' : 'theme-dark';
        }
        
        // 초기화
        setTimeout(() => {
            checkHorizontalLock(); // 첫 화면 잠금 확인
            updateArrowState();
        }, 50);
    </script>
</body>
</html>