<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Portfolio</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;500;700&family=Noto+Sans+KR:wght@300;500;700&display=swap');

        body {
            font-family: 'Noto Sans JP', 'Noto Sans KR', sans-serif;
            background: #000; margin: 0; padding: 0;
            height: 100vh; overflow: hidden;
            overscroll-behavior: none;
        }

        .swiper-container-h, .swiper-container-v, .swiper-slide { width: 100%; height: 100%; }
        .swiper-slide {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            position: relative; overflow: hidden;
        }

        .slide-bg {
            position: absolute; left: 0; top: 0;
            width: 130%; height: 130%;
            background-size: cover; background-position: center;
            filter: blur(15px) brightness(0.7);
            z-index: -1; transform: translate(-15%, -15%);
        }

        .artwork-container {
            position: relative; width: 80%; max-width: 400px;
            border-radius: 12px; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
        }
        .ratio-portrait { aspect-ratio: 3/4; }
        .ratio-landscape { aspect-ratio: 4/3; }
        .ratio-square { aspect-ratio: 1/1; }
        .artwork-image { width: 100%; height: 100%; object-fit: cover; }
        
        /* 메뉴바 */
        .sidebar-menu {
            position: fixed; z-index: 40;
            display: flex; flex-direction: row; gap: 20px;
            bottom: 40px; top: auto; left: 50%; transform: translateX(-50%);
            transition: opacity 0.3s ease;
        }

        /* 메뉴 숨김 클래스 */
        .menu-hidden { 
            opacity: 0 !important; 
            pointer-events: none !important;
            transform: translateX(-50%) translateY(30px) !important; 
        }

        .category-btn {
            width: 45px; height: 45px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px; backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.85);
        }
        .category-btn svg { width: 25px; height: 25px; fill: currentColor; opacity: 0.6; transition: all 0.3s ease; }
        .icon-mask { width: 25px; height: 25px; background-color: currentColor; -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; -webkit-mask-position: center; mask-position: center; opacity: 0.6; transition: all 0.3s ease; }
        .category-btn.active { border-color: currentColor; background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }
        .category-btn.active svg, .category-btn.active .icon-mask { opacity: 1; }

        body.theme-light .category-btn { border-color: rgba(0,0,0,0.2); color: rgba(0,0,0,0.8); } 
        body.theme-dark .category-btn { border-color: rgba(255,255,255,0.3); color: rgba(255,255,255,0.85); }

        .text-floating {
            color: rgba(255, 255, 255, 0.85) !important; 
            text-shadow: 0 4px 8px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, text-shadow 0.3s ease, opacity 0.3s ease;
        }
        .text-floating:hover { transform: translateY(-3px); opacity: 1; text-shadow: 0 10px 20px rgba(0,0,0,0.6); }

        @keyframes blurFadeIn {
            0% { opacity: 0; filter: blur(10px); transform: translateY(5px); }
            100% { opacity: 1; filter: blur(0); transform: translateY(0); }
        }
        
        .intro-line {
            opacity: 0; 
            animation: blurFadeIn 0.8s cubic-bezier(0.2, 1, 0.3, 1) forwards;
            display: block; margin-bottom: 0.5rem; 
        }

        .sns-icon-box { display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; }
        .sns-icon-box i { display: block; line-height: 1; }
        .fa-instagram { font-size: 40px; }
        .fa-line { font-size: 34px; }

        /* 화살표 */
        .nav-arrow {
            position: fixed; z-index: 30;
            color: #fff; font-size: 1.5rem; 
            opacity: 0; cursor: pointer; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
            transition: opacity 0.5s ease; pointer-events: none;
        }
        .nav-arrow.visible { opacity: 0.3; pointer-events: auto; }
        
        .nav-up { top: 130px; left: 50%; transform: translateX(-50%); } 
        .nav-down { bottom: 130px; left: 50%; transform: translateX(-50%); } 
        .nav-left { top: 50%; left: 30px; transform: translateY(-50%); } 
        .nav-right { top: 50%; right: 30px; transform: translateY(-50%); }
        .hidden-arrow { display: none !important; }

        body.theme-light .nav-arrow { color: #000; }
    </style>
</head>
<body class="theme-dark">
    <nav class="fixed left-0 w-full z-50 flex justify-between items-center p-4 md:p-6 transition-colors duration-300" style="top: 35px;">
        <div class="flex items-center gap-3 md:gap-6 pl-2 md:pl-16">
            <div class="text-floating text-lg md:text-xl font-bold tracking-widest uppercase whitespace-nowrap">
                kanae&chinon <br>ペット刺繍
            </div>
        </div>
        <div class="flex flex-row gap-8 items-center mr-2"> 
            <a href="https://www.instagram.com/chin.on" target="_blank" class="text-floating flex items-center gap-2 group cursor-pointer" title="Instagram">
                <div class="sns-icon-box"><i class="fa-brands fa-instagram"></i></div>
                <span class="text-base font-light hidden md:block group-hover:underline">Insta</span>
            </a>

        </div>
    </nav>

    <div id="nav-up" class="nav-arrow nav-up"><i class="fa-solid fa-chevron-up"></i></div>
    <div id="nav-down" class="nav-arrow nav-down"><i class="fa-solid fa-chevron-down"></i></div>
    <div id="nav-left" class="nav-arrow nav-left"><i class="fa-solid fa-chevron-left"></i></div>
    <div id="nav-right" class="nav-arrow nav-right"><i class="fa-solid fa-chevron-right"></i></div>

    <aside class="sidebar-menu" id="sidebar-container"></aside>
    
    <div class="swiper swiper-container-h">
        <div class="swiper-wrapper" id="main-swiper-wrapper"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="data.js"></script>

    <script>
        function copyLineID(id) {
            navigator.clipboard.writeText(id).then(() => {
                alert(`라인 ID가 복사되었습니다!\n(ID: ${id})`);
            }).catch(err => {
                console.error('복사 실패:', err);
                prompt("이 ID를 복사해서 친구추가 하세요:", id);
            });
        }

        const mainSwiperWrapper = document.getElementById('main-swiper-wrapper');
        const sidebarContainer = document.getElementById('sidebar-container');
        
        const navArrows = {
            up: document.getElementById('nav-up'),
            down: document.getElementById('nav-down'),
            left: document.getElementById('nav-left'),
            right: document.getElementById('nav-right')
        };
        const allArrows = Object.values(navArrows);

        function getImagePath(folderName, fileName) { return `images/${folderName}/${fileName}`; }
        function getIconPath(fileName) { return `images/icons/${fileName}`; }

        const allCategories = [...MY_DATA.galleries];
        if (MY_DATA.bio) allCategories.push({ type: 'bio', ...MY_DATA.bio });

        function createIntroSlide() {
            if (!MY_DATA.intro) return '';
            const introPath = getImagePath(MY_DATA.intro.targetFolderId, MY_DATA.intro.bgImage);
            const isVideo = MY_DATA.intro.bgImage.toLowerCase().endsWith('.mp4');
            let bgHTML = '';

            if (isVideo) {
                bgHTML = `
                    <video autoplay loop muted playsinline 
                        class="absolute top-0 left-0 w-[130%] h-[130%] object-cover -translate-x-[15%] -translate-y-[15%] -z-10"
                        style="filter: brightness(0.7);" 
                        data-swiper-parallax="50%">
                        <source src="${introPath}" type="video/mp4">
                    </video>
                `;
            } else {
                bgHTML = `
                    <div class="slide-bg" 
                        style="background-image: url('${introPath}'); 
                               background-color: #ffffff;
                               background-size: contain;
                               background-repeat: no-repeat;
                               background-position: center;
                               width: 100%; height: 100%;
                               top: 0; left: 0; transform: none;
                               filter: none;"
                        data-swiper-parallax="0">
                    </div>
                `;
            }

            const messageLines = MY_DATA.intro.message.split('\n');
            const animatedTextHTML = messageLines.map((line, index) => {
                if(line.trim() === '') return `<div class="intro-line" style="height: 1rem; animation-delay: ${index * 0.15}s;"></div>`;
                return `<div class="intro-line text-lg md:text-xl leading-relaxed text-floating" style="animation-delay: ${index * 0.15}s;">${line}</div>`;
            }).join('');

            return `
                <div class="swiper-slide intro-slide" data-theme="dark">
                    ${bgHTML}
                    <div class="artwork-container ratio-portrait" style="border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02);">
                        <div class="p-8 flex flex-col items-center justify-center text-center h-full w-full">
                            <div class="w-full">
                                ${animatedTextHTML}
                            </div>
                            <div class="mt-12 text-floating opacity-70 animate-bounce">
                                <i class="fa-solid fa-chevron-down text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        allCategories.forEach((cat, index) => {
            const btn = document.createElement('button');
            btn.className = `category-btn ${index === 0 ? 'active' : ''}`;
            btn.onclick = () => swiperH.slideTo(index);
            
            if (cat.icon.startsWith('M')) {
                btn.innerHTML = `<svg viewBox="0 0 24 24"><path d="${cat.icon}"/></svg>`;
            } else {
                const iconUrl = getIconPath(cat.icon);
                btn.innerHTML = `<div class="icon-mask" style="-webkit-mask-image: url('${iconUrl}'); mask-image: url('${iconUrl}');"></div>`;
            }
            sidebarContainer.appendChild(btn);

            const hSlide = document.createElement('div');
            hSlide.className = 'swiper-slide';

            // 1층: 인트로 슬라이드 (공통)
            let vSlidesHTML = createIntroSlide();

            if (cat.type === 'bio') {
                // ============================================
                // [수정됨] Bio 페이지: 표지 페이지 제거하고 바로 히스토리 시작
                // ============================================
                
                // 2층~N층: 히스토리 아이템 (바로 시작)
                cat.history.forEach(item => {
                    const itemImg = getImagePath(cat.id, item.img);
                    vSlidesHTML += `
                        <div class="swiper-slide" data-theme="dark">
                            <div class="slide-bg" style="background-image: url('${itemImg}'); filter: blur(20px) brightness(0.5);" data-swiper-parallax="50%"></div>
                            <div class="artwork-container ratio-portrait">
                                <img src="${itemImg}" class="artwork-image">
                                <div class="absolute bottom-0 left-0 w-full p-6 pb-28 bg-gradient-to-t from-black/90 via-black/50 to-transparent text-center">
                                    <h3 class="text-2xl font-bold text-floating mb-1">${item.title}</h3>
                                    <p class="text-gray-300 text-sm text-floating">${item.date}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });

            } else {
                // 일반 갤러리 슬라이드
                vSlidesHTML += cat.slides.map(slide => {
                    const imgPath = getImagePath(cat.id, slide.img);
                    return `
                        <div class="swiper-slide" data-theme="${slide.theme}">
                            <div class="slide-bg" style="background-image: url('${imgPath}'); ${slide.theme==='light' ? 'filter: blur(15px) brightness(1.2);' : ''}" data-swiper-parallax="50%"></div>
                            <div class="artwork-container ${slide.ratio}">
                                <img src="${imgPath}" class="artwork-image">
                            </div>
                        </div>
                    `;
                }).join('');
            }

            hSlide.innerHTML = `
                <div class="swiper swiper-container-v">
                    <div class="swiper-wrapper">${vSlidesHTML}</div>
                    <div class="swiper-pagination"></div>
                </div>
            `;
            
            mainSwiperWrapper.appendChild(hSlide);
        });

        let arrowTimer;
        function flashArrows() {
            if (isCurrentSlideIntro()) {
                allArrows.forEach(arrow => arrow.classList.remove('visible'));
            } else {
                allArrows.forEach(arrow => arrow.classList.add('visible'));
                clearTimeout(arrowTimer);
                arrowTimer = setTimeout(() => {
                    allArrows.forEach(arrow => arrow.classList.remove('visible'));
                }, 2000);
            }
        }

        function isCurrentSlideIntro() {
            const activeHSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeHSlide.querySelector('.swiper-container-v')?.swiper;
            return (vSwiper && vSwiper.activeIndex === 0);
        }

        function checkMenuVisibility() {
            const activeHSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeHSlide.querySelector('.swiper-container-v')?.swiper;
            
            if (vSwiper) {
                if (vSwiper.activeIndex === 0) {
                    sidebarContainer.classList.add('menu-hidden');
                } else {
                    sidebarContainer.classList.remove('menu-hidden');
                }
            }
        }

        var swiperH = new Swiper(".swiper-container-h", {
            spaceBetween: 50, direction: 'horizontal', effect: 'slide', speed: 600,
            allowTouchMove: false,
            on: { 
                slideChangeTransitionStart: function () {
                    const activeVSwiper = this.slides[this.activeIndex].querySelector('.swiper-container-v')?.swiper;
                    if(activeVSwiper) {
                        activeVSwiper.slideTo(1, 0); 
                    }
                },
                slideChange: function () { 
                    updateActiveButton(this.activeIndex); 
                    updateThemeColor(); 
                    updateArrowState(); 
                    flashArrows(); 
                    checkMenuVisibility(); 
                },
                init: function() { 
                    setTimeout(() => { 
                        updateArrowState(); 
                        checkMenuVisibility(); 
                    }, 100); 
                }
            }
        });

        var swiperV = new Swiper(".swiper-container-v", {
            direction: "vertical", spaceBetween: 0, mousewheel: true, parallax: true,
            speed: 1000, nested: true, touchRatio: 1.2, resistanceRatio: 0.65,
            on: { 
                slideChange: function () { 
                    updateThemeColor(); 
                    updateArrowState();
                    flashArrows(); 
                    checkHorizontalLock();
                    checkMenuVisibility();
                } 
            }
        });

        function checkHorizontalLock() {
            const activeHSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeHSlide.querySelector('.swiper-container-v')?.swiper;
            
            if (vSwiper) {
                if (vSwiper.activeIndex === 0) {
                    swiperH.allowTouchMove = false;
                } else {
                    swiperH.allowTouchMove = true;
                }
            }
        }

        navArrows.left.onclick = () => { swiperH.slidePrev(); flashArrows(); };
        navArrows.right.onclick = () => { swiperH.slideNext(); flashArrows(); };
        navArrows.up.onclick = () => {
            const activeSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeSlide.querySelector('.swiper-container-v')?.swiper;
            if(vSwiper) { vSwiper.slidePrev(); flashArrows(); }
        };
        navArrows.down.onclick = () => {
            const activeSlide = swiperH.slides[swiperH.activeIndex];
            const vSwiper = activeSlide.querySelector('.swiper-container-v')?.swiper;
            if(vSwiper) { vSwiper.slideNext(); flashArrows(); }
        };
        
        document.addEventListener('touchstart', flashArrows);
        document.addEventListener('click', flashArrows);

        function updateArrowState() {
            if (isCurrentSlideIntro()) {
                allArrows.forEach(arrow => arrow.classList.add('hidden-arrow'));
                return;
            }

            if (swiperH.isBeginning) navArrows.left.classList.add('hidden-arrow');
            else navArrows.left.classList.remove('hidden-arrow');

            if (swiperH.isEnd) navArrows.right.classList.add('hidden-arrow');
            else navArrows.right.classList.remove('hidden-arrow');

            const activeHIndex = swiperH.activeIndex;
            const activeSlide = swiperH.slides[activeHIndex];
            const vSwiperContainer = activeSlide.querySelector('.swiper-container-v');
            
            if (vSwiperContainer) {
                const vSwiper = vSwiperContainer.swiper;
                if (vSwiper.activeIndex > 0) navArrows.up.classList.remove('hidden-arrow');
                else navArrows.up.classList.add('hidden-arrow');

                if (vSwiper.isEnd) navArrows.down.classList.add('hidden-arrow');
                else navArrows.down.classList.remove('hidden-arrow');
            }
        }

        function updateActiveButton(index) {
            const btns = document.querySelectorAll('.category-btn');
            btns.forEach(b => b.classList.remove('active'));
            if(btns[index]) btns[index].classList.add('active');
        }

        function updateThemeColor() {
            const activeHSlide = document.querySelectorAll('.swiper-container-h > .swiper-wrapper > .swiper-slide')[swiperH.activeIndex];
            if (!activeHSlide) return;
            const vSwiperContainer = activeHSlide.querySelector('.swiper-container-v');
            if(vSwiperContainer && vSwiperContainer.swiper) {
                const activeVSlide = vSwiperContainer.swiper.slides[vSwiperContainer.swiper.activeIndex];
                if(activeVSlide) {
                    applyTheme(activeVSlide.getAttribute('data-theme'));
                    return;
                }
            }
            if (activeHSlide.getAttribute('data-theme')) {
                applyTheme(activeHSlide.getAttribute('data-theme'));
            }
        }

        function applyTheme(theme) {
            document.body.className = theme === 'light' ? 'theme-light' : 'theme-dark';
        }
        
        setTimeout(() => {
            checkHorizontalLock(); 
            updateArrowState();
            checkMenuVisibility(); 
        }, 50);
    </script>
</body>
</html>